<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>Screenly OSE Asset Control Center</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="stylesheet" type="text/css" href="style.css">
<link rel="shortcut icon" href="favicon.ico" type="image/x-icon">
<link rel="icon" href="favicon.ico" type="image/x-icon">

<script>	
function changeIpFunction() {
	// clear all current contents from elements if any
	document.getElementById("current_assets").innerHTML = "";
	document.getElementById("show_total_assets").innerHTML = "<b>Total Assets on Device: </b>";
	document.getElementById("current_screenly_pi_url").innerHTML = "<b>Current Device URL: </b>";
	document.getElementById("show_array_ids").innerHTML = "";
	
	// begin main function/process
	var ip = document.getElementById("ipfromform").value;
	document.getElementById("print_ip").innerHTML = "<b>Current Device IP: </b>" + ip;

	let url = 'http://' + ip + '/api/v1.2/assets';
	var xmlhttp = new XMLHttpRequest();

	xmlhttp.onreadystatechange = function() {
	if (this.readyState == 4 && this.status == 200) {
		var testArray = [];
		var myObj = JSON.parse(this.responseText);
		var total_assets_int = myObj.length;
		for (var i = 0; i < myObj.length; i++) {
		document.getElementById("current_assets").innerHTML += "<b>Asset Array: </b>" + i + "<br>";
		document.getElementById("current_assets").innerHTML += "<b>Asset ID: </b>" + myObj[i].asset_id + "<br>";
		document.getElementById("current_assets").innerHTML += "<b>Asset Name: </b>" + myObj[i].name + "<br>";
		document.getElementById("current_assets").innerHTML += "<b>Asset URL: </b>" + myObj[i].uri + "<br>";
		document.getElementById("current_assets").innerHTML += "<b>Asset Enabled: </b>" + myObj[i].is_enabled + "<br>";
		document.getElementById("current_assets").innerHTML += "<b>Asset Type: </b>" + myObj[i].mimetype + "<br>";
		document.getElementById("current_assets").innerHTML += "<b>Asset Start Date: </b>" + myObj[i].start_date + "<br>";
		document.getElementById("current_assets").innerHTML += "<b>Asset End Date: </b>" + myObj[i].end_date + "<br>";
		document.getElementById("current_assets").innerHTML += "<b>Asset Duration: </b>" + myObj[i].duration + "<br><br>";
		// testing to see if an array of only asset IDs can be printed
		testArray += myObj[i].asset_id + "<br>";
		}
	document.getElementById("current_screenly_pi_url").innerHTML = "<b>Current Device URL: </b>" + url + "<br>";
	document.getElementById("show_total_assets").innerHTML = "<b>Total Assets on Device: </b>" + total_assets_int + "<br>";
	document.getElementById("show_array_ids").innerHTML = testArray;
	}
	};

xmlhttp.open("GET", url, true);
xmlhttp.send();

}; //this is closing from the changeIpFunction

/*
function disableAllAssets(arr) {
  var asseturl = "http://192.168.1.8/api/v1.2/assets/0ef41b93f855433ca87a9f52b763c50f"
  var out = "";
  var i;
  for(i = 0; i < arr.length; i++) {
  		myObj[i].asset_id
        out += '<a href="' + arr[i].url + '">' +
        arr[i].display + '</a><br>';
    }
  document.getElementById("disabled_assets_confirm").innerHTML = "All Assets Disabled!";
  xmlhttp.open("PATCH", asseturl, true);
  xmlhttp.send();
} */
/*
var xhr = new XMLHttpRequest();
xhr.open("PATCH", "http://192.168.1.8/api/v1.2/assets/0ef41b93f855433ca87a9f52b763c50f", true);
xhr.setRequestHeader("Content-Type", "application/json");

xhr.onreadystatechange = function() {
    if (this.readyState === XMLHttpRequest.DONE && this.status === 200) {
        // Request finished. Do processing here.
        -d "{\"is_enabled\": 0}"';
    }
}

xhr.send(document);
}*/

</script>

</head>
<body bgcolor="#3e32a8">
<center>
<img src="screenly_logo90x90.png">
<h2>Screenly OSE - Asset Control Center</h2>

<div id="current_screenly_pi_url"><br></div>
<div id="print_ip"><br></div>
<div id="show_total_assets""><br></div>

<hr style="width: 90%; border: 1px dashed white">
<div><br>
<b>Enter IP of Screenly Device:</b><br>

<input type="text" id="ipfromform" size="40" autofocus><br><br>
<button class="button" onclick="changeIpFunction()">Get Info</button>
<button class="button" onclick="document.getElementById('ipfromform').value = ''">Clear</button>

</center></div>

<button class="button" onclick="disableAllAssets()">Disable All Assets</button>
<p id="disabled_assets_confirm"></p>

<div id="show_array_ids"><br></div>

<div id="current_assets" style="padding-left: 10px"></div>

<script>
document.getElementById("show_total_assets").innerHTML = "<b>Total Assets on Device: </b>";
document.getElementById("current_screenly_pi_url").innerHTML = "<b>Current Device URL: </b>";
document.getElementById("print_ip").innerHTML = "<b>Current Device IP: </b>";
</script>

</body>
</html>